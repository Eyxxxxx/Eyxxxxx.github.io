<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>




<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"eyxxxxx.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本书一至十章的部分习题\代码题记录">
<meta property="og:type" content="article">
<meta property="og:title" content="汇编语言（第四版）-王爽 (题解)-1">
<meta property="og:url" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/index.html">
<meta property="og:site_name" content="Dig a Big Hole">
<meta property="og:description" content="本书一至十章的部分习题\代码题记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/实验5-5.png">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/实验5-6.png">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/实验6.png">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/实验7.png">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/实验9.png">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/实验10-1显示字符串.png">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/实验10-2解决除法溢出的问题.png">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/实验10-3数值显示.png">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/课设1-结构图.png">
<meta property="og:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/课设1-终稿.png">
<meta property="article:published_time" content="2021-09-11T15:49:10.738Z">
<meta property="article:modified_time" content="2021-09-22T03:19:47.398Z">
<meta property="article:author" content="yx">
<meta property="article:tag" content="assembly">
<meta property="article:tag" content="DOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/实验5-5.png">

<link rel="canonical" href="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>汇编语言（第四版）-王爽 (题解)-1 | Dig a Big Hole</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Dig a Big Hole" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Dig a Big Hole</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Input/Output</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">3</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">1</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">4</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yx">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dig a Big Hole">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          汇编语言（第四版）-王爽 (题解)-1
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-11 23:49:10" itemprop="dateCreated datePublished" datetime="2021-09-11T23:49:10+08:00">2021-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-22 11:19:47" itemprop="dateModified" datetime="2021-09-22T11:19:47+08:00">2021-09-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%87%AA%E5%B7%B1%E7%8E%A9%E5%84%BF/" itemprop="url" rel="index"><span itemprop="name">自己玩儿</span></a>
                </span>
            </span>

          
            <span id="/posts/masm-wangshuang-exercise-1/" class="post-meta-item leancloud_visitors" data-flag-title="汇编语言（第四版）-王爽 (题解)-1" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本书一至十章的部分习题\代码题记录</p>
<a id="more"></a>
<h2 id="参考资料"><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h2>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Mayfly-nymph/p/12046088.html">《汇编语言》（王爽）课后答案 - Hk_Mayfly - 博客园</a></p>
<h2 id="注"><a class="markdownIt-Anchor" href="#注"></a> 注</h2>
<p>实验代码如果用notepad++等记事本写的，<strong>应当将文件的编码格式保存为utf-8，其它编码格式保存的文件会在编译的时候报莫名其妙的错</strong></p>
<h2 id="ch6"><a class="markdownIt-Anchor" href="#ch6"></a> CH6</h2>
<h3 id="实验5"><a class="markdownIt-Anchor" href="#实验5"></a> 实验5</h3>
<p>(2).4 该段实际占有的空间为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">⌈</mo><mfrac><mi>N</mi><mn>16</mn></mfrac><mo stretchy="false">⌉</mo><mo>×</mo><mn>16</mn></mrow><annotation encoding="application/x-tex">\lceil \frac{N}{16}\rceil\times 16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mopen">⌈</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌉</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span></span></span></span>，
即一个段会自动对齐成16字节的倍数</p>
<p>(5)<strong>不应该把段寄存器ss当作一个存段地址的寄存器来用，也不应该把栈段当作数据段来用（见P195检测点10.5）。这都不符合代码规范！</strong> 此外，debug时，定义一个栈段后，栈空间会被debug程序用于保存现场！所以如果简单把一个数据段通过ss寄存器定义为一个栈段在debug模式下的单步调试中会导致数据段中的数据丢失！<strong>（第(6)题同理）</strong> (debug程序如何使用栈空间见课本p250，和本文第十二章部分的笔记。)</p>
<p>因为这里数据都是静态的、固定的，所以考虑用偏移来解题比较简单。
即标号b的地址为<code>a+10H</code>，标号c的地址为<code>a+20H</code></p>
<p>注意运算过程中选择合适大小的寄存器</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</span><br><span class="line"></span><br><span class="line">a <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">db</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span></span><br><span class="line">a ends</span><br><span class="line"></span><br><span class="line">b <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">db</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span></span><br><span class="line">b ends</span><br><span class="line"></span><br><span class="line">c <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">db</span> <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">c ends</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"></span><br><span class="line"><span class="symbol"> start:</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,a</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">0</span> <span class="comment">;offset</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">8</span> <span class="comment">;counter</span></span><br><span class="line">  </span><br><span class="line"><span class="symbol"> s:</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">dl</span>,<span class="number">0</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">dl</span>,<span class="number">0</span>[<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">dl</span>,<span class="number">16</span>[<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">mov</span> <span class="number">32</span>[<span class="built_in">bx</span>],<span class="built_in">dl</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">loop</span> s</span><br><span class="line">  </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"> <span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line">code ends</span><br><span class="line"></span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/实验5-5.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">实验5-5运行结果</div>
</center>
<p>(6)<br>
<strong>题目要求</strong>：用<code>push指令</code>将a段中的前8个字型数据，逆序存储到b段中。<br>
<strong>分析</strong>：题中说用<code>push指令</code>只是提示我们可以利用本章学的栈段作过渡工具。并非是让我们直接将<code>b segment</code>同时定义为数据段和栈段。
因此尽管利用栈从高地址向低地址存储的特性，将<code>b segment</code>定义为栈段可以直接完成题目逆序存储的要求。但这是完全不对的！  <strong>存储数据的地方应当是数据段，而数据段不应该同时被定义为一个栈段。</strong><br>
<strong>正确解题思路</strong>：定义一个栈段，将数据先全部存入栈段完成逆序，然后再完全弹出至目标存储地址。即需要遍历待搬运数据两次。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</span><br><span class="line"></span><br><span class="line">a <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0ah</span>,<span class="number">0bh</span>,<span class="number">0ch</span>,<span class="number">0dh</span>,<span class="number">0eh</span>,<span class="number">0fh</span>,<span class="number">0ffh</span></span><br><span class="line">a ends</span><br><span class="line"></span><br><span class="line">b <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">b ends</span><br><span class="line"></span><br><span class="line">stack <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">start:</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,stack</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ss</span>,<span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">sp</span>,<span class="number">16</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,a</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">8</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol"> s:</span></span><br><span class="line">  <span class="keyword">push</span> [<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">loop</span> s</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,b</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">8</span></span><br><span class="line"><span class="symbol"> s0:</span></span><br><span class="line">  <span class="keyword">pop</span> [<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">loop</span> s0</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"> <span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line"></span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/实验5-6.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">实验5-6运行结果</div>
</center>
<h2 id="ch7"><a class="markdownIt-Anchor" href="#ch7"></a> CH7</h2>
<h3 id="实验6"><a class="markdownIt-Anchor" href="#实验6"></a> 实验6</h3>
<p>(2)注意细节，</p>
<ul>
<li>比如起始地址下标从0开始数；</li>
<li>数据段中的单词如果不手动用空格对齐至16字节，是不会有任何形式的自动对齐的，<strong>所以要手动打上空格，便于后续的寻址操作。</strong></li>
</ul>
<p>完整代码如下</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code, <span class="built_in">ss</span>:stack, <span class="built_in">ds</span>:data</span><br><span class="line"></span><br><span class="line">stack <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">data <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;1. display      &#x27;</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;2. brows        &#x27;</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;3. replace      &#x27;</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;4. modify       &#x27;</span></span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"><span class="symbol"> start:</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,data <span class="comment">;initialize reg ds</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,stack <span class="comment">;initialize a stack</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ss</span>,<span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">sp</span>,<span class="number">16</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">0</span> <span class="comment">; row counter</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">4</span> <span class="comment">; counter for outer loop</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol"> s:</span>  <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">4</span> <span class="comment">; counter for inner loop</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">di</span>,<span class="number">0</span> <span class="comment">; column counter</span></span><br><span class="line">  </span><br><span class="line"><span class="symbol">  s0:</span> </span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">al</span>,[<span class="built_in">bx</span>+<span class="built_in">di</span>+<span class="number">3</span>] <span class="comment">;lowercase2uppercase</span></span><br><span class="line">   <span class="keyword">and</span> <span class="built_in">al</span>,<span class="number">11011111b</span></span><br><span class="line">   <span class="keyword">mov</span> [<span class="built_in">bx</span>+<span class="built_in">di</span>+<span class="number">3</span>],<span class="built_in">al</span></span><br><span class="line">   <span class="keyword">inc</span> <span class="built_in">di</span></span><br><span class="line">   <span class="keyword">loop</span> s0</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">16</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">loop</span> s</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"> <span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/实验6.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">实验6运行结果</div>
</center>
<h2 id="ch8"><a class="markdownIt-Anchor" href="#ch8"></a> CH8</h2>
<h3 id="实验7"><a class="markdownIt-Anchor" href="#实验7"></a> 实验7</h3>
<p>说明：数据段中有三类数据：年份（字节型），收入（双字型），雇员数（字型）。</p>
<ul>
<li>“年份”每一项为字节型字符串，即每一个数据项占<code>4*1B=4B</code></li>
<li>“收入”每一项为双字型，即每一个数据项占<code>1*4B=4B</code></li>
<li>“雇员数”每一项为字型，即每一个数据项占<code>1*2B=2B</code></li>
</ul>
<p>用bx寄存器存储每一个数据项相对于该类数据起始地址的偏移地址，又因为<code>mul</code>指令和<code>div</code>指令用起来都比较麻烦，所以bx的步长取最小的数据项（雇员类）即在最后每次加2字节，然后对于“年份”和“收入”这俩每项数据占4个字节的，通过计算<code>add bx,bx</code>实现<code>bx*2</code>得到这两类数据相对起点的偏移。</p>
<p><strong>这里偏移地址、相对地址、基址的计算是比较重要的，如果哪一个部分算错，导致写入（搬运数据）时覆盖了代码段则会死机。</strong></p>
<p>完整代码如下</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</span><br><span class="line"></span><br><span class="line">data <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;1975&#x27;</span>,<span class="string">&#x27;1976&#x27;</span>,<span class="string">&#x27;1977&#x27;</span>,<span class="string">&#x27;1978&#x27;</span>,<span class="string">&#x27;1979&#x27;</span>,<span class="string">&#x27;1980&#x27;</span>,<span class="string">&#x27;1981&#x27;</span>,<span class="string">&#x27;1982&#x27;</span>,<span class="string">&#x27;1983&#x27;</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;1984&#x27;</span>,<span class="string">&#x27;1985&#x27;</span>,<span class="string">&#x27;1986&#x27;</span>,<span class="string">&#x27;1987&#x27;</span>,<span class="string">&#x27;1988&#x27;</span>,<span class="string">&#x27;1989&#x27;</span>,<span class="string">&#x27;1990&#x27;</span>,<span class="string">&#x27;1991&#x27;</span>,<span class="string">&#x27;1992&#x27;</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;1993&#x27;</span>,<span class="string">&#x27;1994&#x27;</span>,<span class="string">&#x27;1995&#x27;</span></span><br><span class="line">  <span class="comment">;以上是表示21年的21个字符串</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">16</span>,<span class="number">22</span>,<span class="number">382</span>,<span class="number">1356</span>,<span class="number">2390</span>,<span class="number">8000</span>,<span class="number">16000</span>,<span class="number">24486</span>,<span class="number">50065</span>,<span class="number">97479</span>,<span class="number">140417</span>,<span class="number">197514</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">345980</span>,<span class="number">590827</span>,<span class="number">803530</span>,<span class="number">1183000</span>,<span class="number">1843000</span>,<span class="number">2759000</span>,<span class="number">3753000</span>,<span class="number">4649000</span>,<span class="number">5937000</span></span><br><span class="line">  <span class="comment">;以上是表示21年公司总收入的21个dword型数据</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">3</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">13</span>,<span class="number">28</span>,<span class="number">38</span>,<span class="number">130</span>,<span class="number">220</span>,<span class="number">476</span>,<span class="number">778</span>,<span class="number">1001</span>,<span class="number">1442</span>,<span class="number">2258</span>,<span class="number">2793</span>,<span class="number">4037</span>,<span class="number">5635</span>,<span class="number">8226</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">11542</span>,<span class="number">14430</span>,<span class="number">15257</span>,<span class="number">17800</span></span><br><span class="line">  <span class="comment">;以上是表示21年公司雇员人数的21个word型数据</span></span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">table <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">db</span> <span class="number">21</span> dup (<span class="string">&#x27;year summ ne ?? &#x27;</span>)</span><br><span class="line">table ends</span><br><span class="line"></span><br><span class="line">stack <span class="meta">segment</span> <span class="comment">;reg会不够用，所以需要定义一个栈暂存数据</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">8</span> dup (<span class="number">0</span>)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"><span class="symbol">start:</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,data</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,table <span class="comment">;用一个段寄存器存table的地址</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">es</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,stack </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ss</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">0</span>  <span class="comment">;源数据地址相对基址的偏移地址</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">di</span>,<span class="number">0</span>  <span class="comment">;目的地址的偏移</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">21</span>  <span class="comment">;循环计数器</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol"> s:</span> </span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">cx</span>  <span class="comment">;将循环计数器的值入栈后，可将cx继续当作临时reg使用</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">;搬运年份</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">bx</span>  </span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,[<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">ax</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,[<span class="built_in">bx</span>+<span class="number">2</span>]</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>+<span class="number">2</span>],<span class="built_in">ax</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">;搬运收入</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="built_in">bx</span> <span class="comment">;</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">84</span> <span class="comment">;这是基址</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">di</span>,<span class="number">5</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,[<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">dx</span>,[<span class="built_in">bx</span>+<span class="number">2</span>]</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">ax</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>+<span class="number">2</span>],<span class="built_in">dx</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">;搬运雇员数</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">168</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">di</span>,<span class="number">5</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,[<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">;计算人均收入并存储在指定位置</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">di</span>,<span class="number">3</span></span><br><span class="line">  <span class="keyword">div</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">ax</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">;计算步长</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">di</span>,<span class="number">3</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">2</span> <span class="comment">;详见前面说明</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">loop</span> s</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"> <span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line">code ends</span><br><span class="line"></span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/实验7.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">实验7运行结果</div>
</center>
<p>反思总结：<br>
相较于参考资料答案中给出的代码，我的代码用了更少的寄存器（没有用bp和si寄存器）并且通过展平减少了一重循环，更好的利用了设置的栈，此外，在地址的计算上更依赖于数数上的技巧使得代码不是很直观且容易出错。
如果充分利用bp和si寄存器，并且颠倒一下搬运数据的顺序代码可以更简洁，不过懒得搞了，大概是这么个意思。</p>
<h2 id="ch9"><a class="markdownIt-Anchor" href="#ch9"></a> CH9</h2>
<h3 id="检测点91"><a class="markdownIt-Anchor" href="#检测点91"></a> 检测点9.1</h3>
<p>这里 <code>mov [bx+2],cs</code> 等效于 <code>add ax,1 mov [bx+2],ax</code> 这两条指令合并的效果，但是题目只给了一行，所以不能用后面的写法。主要是x86里各种指令的操作对象允许的不同，但这里是<code>mov</code> 的操作数是可以有段寄存器cs的</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</span><br><span class="line"></span><br><span class="line">data <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">12345678h</span></span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"><span class="symbol">start:</span> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,data</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> [<span class="built_in">bx</span>],<span class="built_in">bx</span></span><br><span class="line"> <span class="keyword">mov</span> [<span class="built_in">bx</span>+<span class="number">2</span>],<span class="built_in">cs</span></span><br><span class="line"> <span class="keyword">jmp</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="number">0</span>]</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<h3 id="实验8"><a class="markdownIt-Anchor" href="#实验8"></a> 实验8</h3>
<p>注：</p>
<ul>
<li><code>jmp short 标号</code> 占两个字节</li>
<li><code>nop</code> 指令占一个字节</li>
</ul>
<p>源程序中的代码<code>jmp short s1</code>具有迷惑性，不能被骗了。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov</span> <span class="built_in">di</span>,offset s</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">si</span>,offset s2</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">cs</span>:[<span class="built_in">si</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">cs</span>:[<span class="built_in">di</span>],<span class="built_in">ax</span></span><br></pre></td></tr></table></figure>
<p>这段代码的主要用处是将s2处的第一条指令搬到s处。要注意这个搬运是<strong>在程序运行时发生</strong>的，而程序运行<strong>前</strong>需要经过<strong>编译</strong>、连接，所以搬运的不是原始代码中的指令<code>jmp short s1</code>，而是编译后的结果<code>EBF6</code>。</p>
<p><code>EB</code>对应<code>jmp</code>指令，<code>F6</code>即为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>−</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">-10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mord">0</span></span></span></span>，所以标号s处的指令为<code>EBF6</code>，考虑到 <code>位移=标号处的地址-jmp指令后的第一个字节的地址</code>，所以标号s处的 <code>EBF6</code> 执行完后 <code>IP=0000</code>，恰好指向开头的 <code>mov ax,4c00h</code>。</p>
<p>所以程序可以正常结束。</p>
<h3 id="实验9"><a class="markdownIt-Anchor" href="#实验9"></a> 实验9</h3>
<ul>
<li>好吧，参考资料这题好像写的比我简洁... &gt; &lt;|||</li>
<li>先实现一个颜色的，三个颜色就在此基础上外面再套一层循环。</li>
<li><strong>选择恰当的寄存器，操作8位数据时应该用8位寄存器。</strong> 如果用16位寄存器，会导致写入多余数据（即将高八位数据也写入内存或者其它寄存器中），将引起不必要的麻烦。</li>
</ul>
<p>完整代码如下</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code, <span class="built_in">ds</span>:data</span><br><span class="line"></span><br><span class="line">data <span class="meta">segment</span> </span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;welcome to masm!&#x27;</span> <span class="comment">;共16个字节（包括空格，空格也是字符！）</span></span><br><span class="line"> <span class="built_in">db</span> <span class="number">02h</span>,<span class="number">24h</span>,<span class="number">71h</span></span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">stack <span class="meta">segment</span> <span class="comment">;搞个栈暂存数据，后面要腾挪寄存器</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">8</span> dup(<span class="number">0</span>)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">start:</span> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,data</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">si</span>,<span class="number">0</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">0b800h</span> <span class="comment">;页首，立即数开头若是字母需补0</span></span><br><span class="line"> <span class="keyword">add</span> <span class="built_in">ax</span>,<span class="number">0078h</span> <span class="comment">;从第12行开始打印。计算行偏移加在段地址上，加在段地址上的偏移需除以16！第零行占160字节但是不显示，所以780h=160B*12(详见参考资料)</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">es</span>,<span class="built_in">ax</span>  <span class="comment">;存放最终段地址</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;一共三种颜色搞3行</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">3</span></span><br><span class="line"><span class="symbol"> s3:</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">di</span>,<span class="number">64</span>  <span class="comment">;计算列偏移作为偏移地址</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">16</span> <span class="comment">;以下循环 将要输出的内容从data段搬运到显示缓冲区，并调整颜色</span></span><br><span class="line"><span class="symbol">  s:</span></span><br><span class="line">   <span class="keyword">push</span> <span class="built_in">cx</span> <span class="comment">;暂存cx，因为后面还要用到cx寄存器进行跳转</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">;搬运内容</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">ds</span>:[<span class="built_in">si</span>]</span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">al</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">;操作属性</span></span><br><span class="line">   <span class="keyword">inc</span> <span class="built_in">di</span></span><br><span class="line">   <span class="comment">;从栈中取外层循环计数器数值</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">bp</span>,<span class="built_in">sp</span> </span><br><span class="line">   <span class="keyword">add</span> <span class="built_in">bp</span>,<span class="number">2</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">bp</span>,<span class="built_in">ss</span>:[<span class="built_in">bp</span>] </span><br><span class="line">   <span class="comment">;3 - 外层counter = 颜色index</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">3</span></span><br><span class="line">   <span class="keyword">sub</span> <span class="built_in">ax</span>,<span class="built_in">bp</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">bp</span>,<span class="built_in">ax</span></span><br><span class="line">   <span class="comment">;读取颜色数据</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">ds</span>:[<span class="built_in">bp</span>+<span class="number">16</span>] <span class="comment">;用一个字节表示属性，所以此处用8位寄存器，16为字符串的大小</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">al</span> </span><br><span class="line">  <span class="comment">;处理步长</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">di</span>  <span class="comment">;目标数据偏移地址+1，属性占用的字节在操作属性时加过了</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">si</span>  <span class="comment">;源数据偏移+1</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">cx</span>  <span class="comment">;还原循环变量</span></span><br><span class="line">  <span class="keyword">loop</span> s  <span class="comment">;对下一个源数据操作</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">es</span></span><br><span class="line"> <span class="keyword">add</span> <span class="built_in">ax</span>,<span class="number">0ah</span> <span class="comment">;增加一行即+0a0h，因为是对段地址操作，所以要将0a0除以16，所以这里加0ah</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">es</span>,<span class="built_in">ax</span> <span class="comment">;段寄存器+1，处理下一行</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">si</span>,<span class="number">0</span> <span class="comment">;从头读取数据</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line"> <span class="keyword">loop</span> s3</span><br><span class="line"> </span><br><span class="line"> <span class="comment">;操作完成，程序返回</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"> <span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line"> </span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/实验9.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">实验9运行结果</div>
</center>
<h2 id="ch10"><a class="markdownIt-Anchor" href="#ch10"></a> CH10</h2>
<h3 id="实验10"><a class="markdownIt-Anchor" href="#实验10"></a> 实验10</h3>
<h4 id="1-显示字符串"><a class="markdownIt-Anchor" href="#1-显示字符串"></a> 1. 显示字符串</h4>
<ul>
<li>**选择恰当的寄存器！**使用<code>ax,bx,cx,dx</code>时应考虑选择8位版本，还是16位版本。尤其是搭配<code>mul</code>指令和<code>div</code>指令时。当然，不恰当的寄存器选择，即使只是加减法也会引发各种bug。</li>
<li>使用栈之前当然还是要自己定义栈段啊！</li>
</ul>
<p>完整代码如下</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;名称: show_str</span></span><br><span class="line"><span class="comment">;功能：在指定的位置，用指定的颜色，显示一个用0结束的字符串</span></span><br><span class="line"><span class="comment">;参数： (dh)=行号(取值范围0~24), </span></span><br><span class="line"><span class="comment">;  (dl)=列号(取值范围0~79)</span></span><br><span class="line"><span class="comment">;  (cl)=颜色, </span></span><br><span class="line"><span class="comment">;  ds:si 指向字符串的首地址</span></span><br><span class="line"><span class="comment">;返回：无</span></span><br><span class="line"><span class="comment">;test_data: 在屏幕8行3列处，用绿色显示data段中的字符串</span></span><br><span class="line"></span><br><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</span><br><span class="line"></span><br><span class="line">data <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;welcome to masm!&#x27;</span>,<span class="number">0</span></span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">stack <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">8</span> dup(<span class="number">0</span>)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">start:</span></span><br><span class="line"> <span class="comment">;定义一个栈段</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,stack</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ss</span>,<span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">sp</span>,<span class="number">16</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;传参</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="number">dh</span>,<span class="number">12</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">dl</span>,<span class="number">33</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,data</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">si</span>,<span class="number">0</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">call</span> show_str</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"> <span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol">show_str:</span></span><br><span class="line"> <span class="comment">;用栈保存现场</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">dx</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">si</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">di</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">es</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;先计算行偏移地址，再加到页首起始地址上，存放在es段寄存器中</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">0ah</span></span><br><span class="line"> <span class="keyword">mul</span> <span class="number">dh</span></span><br><span class="line"> <span class="keyword">add</span> <span class="built_in">ax</span>,<span class="number">0b800h</span> <span class="comment">;0b800h是显存的起始地址</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">es</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;计算列偏移地址。列偏移地址的起始地址 是 列号*2-2</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">dl</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bl</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">mul</span> <span class="built_in">bl</span> </span><br><span class="line"> <span class="keyword">sub</span> <span class="built_in">ax</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">di</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;暂存颜色属性</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">cl</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol"> prt:</span></span><br><span class="line"> <span class="comment">;按要求搬运内容至显存指定位置，以指定格式输出</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="number">ch</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="built_in">ds</span>:[<span class="built_in">si</span>]</span><br><span class="line"> <span class="keyword">jcxz</span> ok  <span class="comment">;若cx==0，子程序运行结束</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">cl</span> <span class="comment">;搬运字符</span></span><br><span class="line"> <span class="keyword">inc</span> <span class="built_in">di</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">al</span> <span class="comment">;搬运属性</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">;处理步长</span></span><br><span class="line"> <span class="keyword">inc</span> <span class="built_in">di</span></span><br><span class="line"> <span class="keyword">inc</span> <span class="built_in">si</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">jmp</span> short prt</span><br><span class="line"> </span><br><span class="line"><span class="symbol"> ok:</span></span><br><span class="line"> <span class="comment">;恢复现场</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">es</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">di</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">si</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">dx</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">ret</span> <span class="comment">;返回</span></span><br><span class="line"> </span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/实验10-1显示字符串.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">实验10-1显示字符串</div>
</center>
<h4 id="2-解决除法溢出的问题"><a class="markdownIt-Anchor" href="#2-解决除法溢出的问题"></a> 2. 解决除法溢出的问题</h4>
<ul>
<li>计算公式第一部分<code>int(H/N)</code>时，<strong>注意</strong>应把被除数的高位(H)放在<code>ax</code>中，然后将<code>dx</code>置0，然后进行除数为16位的除法。此时得到的商存放在<code>ax</code>中，为最终要求的结果的高16位；余数在<code>dx</code>中即为下一部分运算所需的<code>rem(H/N)*65536</code>。</li>
</ul>
<p>完整代码如下</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;name:divdw</span></span><br><span class="line"><span class="comment">;function: 进行不会产生溢出的除法运算，被除数为dword型，除数为word型，结果为dword型</span></span><br><span class="line"><span class="comment">;parameter: (ax)=dword型数据的低16位</span></span><br><span class="line"><span class="comment">;   (dx)=dword型数据的高16位</span></span><br><span class="line"><span class="comment">;   (cx)=除数</span></span><br><span class="line"><span class="comment">;return: (ax)=结果的低16位</span></span><br><span class="line"><span class="comment">;   (dx)=结果的高16位</span></span><br><span class="line"><span class="comment">;   (cx)=余数</span></span><br><span class="line"><span class="comment">;test_data F4240H/0AH=0001H 86A0H ... 0</span></span><br><span class="line"><span class="comment">;notation: X: 被除数</span></span><br><span class="line"><span class="comment">;  N: 除数</span></span><br><span class="line"><span class="comment">;  H: X高16位</span></span><br><span class="line"><span class="comment">;  L: X低16位</span></span><br><span class="line"><span class="comment">;  int: 去尾取整</span></span><br><span class="line"><span class="comment">;  rem: 取余数</span></span><br><span class="line"><span class="comment">;equation: X/N=int(H/N)*65536+(rem(H/N)*65536+L)/N</span></span><br><span class="line"></span><br><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</span><br><span class="line"></span><br><span class="line">stack <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">8</span> dup(<span class="number">0</span>)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">start:</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,stack</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ss</span>,<span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">sp</span>,<span class="number">32</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4240h</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">000fh</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">0ah</span></span><br><span class="line"> <span class="keyword">call</span> divdw</span><br><span class="line"></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"> <span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">divdw:</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="built_in">ax</span> <span class="comment">; save L</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">;compute int(H/N) </span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">dx</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">div</span> <span class="built_in">cx</span> <span class="comment">; quotient in ax, remainder in dx</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">ax</span> <span class="comment">;计算结果的高16位入栈保存</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;compute (rem(H/N)*65536+L)/N</span></span><br><span class="line"> <span class="comment">;从bx中取回X低16位(L)</span></span><br><span class="line"> <span class="comment">;rem(H/N)已经在dx中，因为dx是被除数的高16位，所以相当于乘了65536</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">bx</span></span><br><span class="line"> <span class="keyword">div</span> <span class="built_in">cx</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;在指定寄存器中存储结果</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="built_in">dx</span></span><br><span class="line"> <span class="keyword">pop</span> <span class="built_in">dx</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">ret</span></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/实验10-2解决除法溢出的问题.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">实验10-2解决除法溢出的问题</div>
</center>
<h4 id="3数值显示"><a class="markdownIt-Anchor" href="#3数值显示"></a> 3.数值显示</h4>
<ul>
<li>
<p>compute段，计算过程中先得到十进制表示中的最低位后得到最高位，直接输出是低位在左的逆序结果，希望按照高位在左的形式输出。</p>
</li>
<li>
<p>利用栈调整逆序。<strong>注意入栈出栈每次操作单位为一个字（两个字节）。</strong> 分析可知本题得到的余数数据位于低八位。</p>
</li>
<li>
<p>除法过程中，<strong>先将余数入栈</strong>，再判断商是否为0决定是进行下一轮除法还是下一步的其它操作。</p>
</li>
<li>
<p>出栈时，一次出栈两个字节。本题仅用到低8位。</p>
</li>
</ul>
<p>完整代码如下</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;name: dtoc_w</span></span><br><span class="line"><span class="comment">;function: 将word型数据转变为表示十进制数的字符串，字符串以0为结尾符</span></span><br><span class="line"><span class="comment">;parameter: (ax)=word型数据</span></span><br><span class="line"><span class="comment">;   ds:si指向字符串的首地址</span></span><br><span class="line"><span class="comment">;return: null</span></span><br><span class="line"><span class="comment">;application: 将数据12666以十进制的形式在屏幕的8行3列，用黑底绿字显示出来。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</span><br><span class="line"></span><br><span class="line">data <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">10</span> dup(<span class="number">0</span>)</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">stack <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">8</span> dup(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"><span class="symbol">start:</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,stack</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ss</span>,<span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">sp</span>,<span class="number">32</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,data</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">si</span>,<span class="number">0</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">12666</span></span><br><span class="line"> <span class="keyword">call</span> dtoc_w</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="number">dh</span>,<span class="number">8</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">dl</span>,<span class="number">3</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">call</span> show_str</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"> <span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol">dtoc_w:</span></span><br><span class="line"> <span class="comment">;保存现场</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">si</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">ax</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">dx</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;initialize cx,bx</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">10</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;字符串以0为结尾符,应该放在栈底</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol"> compute:</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0</span></span><br><span class="line">  <span class="keyword">div</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">dx</span>,<span class="number">30h</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">dx</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="built_in">ax</span></span><br><span class="line">  <span class="keyword">jcxz</span> save2data <span class="comment">;quotient==0, conversion ends</span></span><br><span class="line">  <span class="keyword">jmp</span> compute</span><br><span class="line"> </span><br><span class="line"><span class="symbol"> save2data:</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="built_in">bl</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ds</span>:[<span class="built_in">si</span>],<span class="built_in">cl</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">si</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">jcxz</span> ok_dtoc_w</span><br><span class="line">  <span class="keyword">jmp</span> save2data</span><br><span class="line"> </span><br><span class="line"> <span class="comment">;恢复现场并返回</span></span><br><span class="line"><span class="symbol"> ok_dtoc_w:</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">dx</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">ax</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">si</span></span><br><span class="line">  <span class="keyword">ret</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol">show_str:</span> </span><br><span class="line"> <span class="comment">;用栈保存现场</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">si</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;先计算行偏移地址，再加到页首起始地址上，存放在es段寄存器中</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">0ah</span></span><br><span class="line"> <span class="keyword">mul</span> <span class="number">dh</span></span><br><span class="line"> <span class="keyword">add</span> <span class="built_in">ax</span>,<span class="number">0b800h</span> <span class="comment">;0b800h是显存的起始地址</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">es</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;计算列偏移地址。列偏移地址的起始地址 是 列号*2-2</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">dl</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bl</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">mul</span> <span class="built_in">bl</span> </span><br><span class="line"> <span class="keyword">sub</span> <span class="built_in">ax</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">di</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;暂存颜色属性</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">cl</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol"> prt:</span></span><br><span class="line">  <span class="comment">;按要求搬运至显存指定位置，以指定格式输出</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">ch</span>,<span class="number">0</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="built_in">ds</span>:[<span class="built_in">si</span>]</span><br><span class="line">  <span class="keyword">jcxz</span> ok_show_str  <span class="comment">;若cx==0，子程序运行结束</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">cl</span> <span class="comment">;搬运字符</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">di</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">al</span> <span class="comment">;搬运属性</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">;处理步长</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">di</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">si</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">jmp</span> short prt</span><br><span class="line"> </span><br><span class="line"><span class="symbol"> ok_show_str:</span></span><br><span class="line">  <span class="comment">;恢复现场</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">si</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">ret</span> <span class="comment">;返回</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/实验10-3数值显示.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">实验10-3数值显示</div>
</center>
<h3 id="课程设计1"><a class="markdownIt-Anchor" href="#课程设计1"></a> 课程设计1</h3>
<h4 id="题目分析"><a class="markdownIt-Anchor" href="#题目分析"></a> 题目分析</h4>
<ul>
<li>预处理操作将每一年的所有数据项<strong>之间</strong>的0换成空格</li>
<li>set space 将每一年的所有数据开始<strong>之前</strong>和结束<strong>之后</strong>的地方换成空格</li>
<li>每年数据除本身字符所占的字节数外，空格数是自己定义的，我按课本P173实验7的方式规划了一下，确保每年数据占32位，这样也比较整齐</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>年份</th>
<th>空格</th>
<th>收入</th>
<th>空格</th>
<th>雇员数</th>
<th>空格</th>
<th>人均收入</th>
<th>空格</th>
</tr>
</thead>
<tbody>
<tr>
<td>下标</td>
<td>0-3</td>
<td>4-7</td>
<td>8-14</td>
<td>15-18</td>
<td>19-23</td>
<td>24-27</td>
<td>28-30</td>
<td>31</td>
</tr>
<tr>
<td>大小</td>
<td>4B</td>
<td>4B</td>
<td>7B</td>
<td>4B</td>
<td>5B</td>
<td>4B</td>
<td>3B</td>
<td>1B</td>
</tr>
</tbody>
</table>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/课设1-结构图.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">课设1-结构图</div>
</center>
<h4 id="总结注意事项"><a class="markdownIt-Anchor" href="#总结注意事项"></a> 总结(注意事项)</h4>
<ul>
<li>
<p>定义域、值域、操作的基本单位</p>
<ul>
<li>
<p>定义域、值域问题实际上也是<strong>边界问题</strong></p>
<ul>
<li>边界问题还包括<strong>终止性的定界符</strong>，比如字符串以0为结尾符的约定</li>
</ul>
</li>
<li>
<p>每一个程序的输入、输出的取值范围(是否会<strong>溢出</strong>)</p>
<ul>
<li>课本p212页提示有些要显示的数据已经<strong>大于</strong> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>65535</mn></mrow><annotation encoding="application/x-tex">65535</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord">5</span><span class="mord">5</span><span class="mord">3</span><span class="mord">5</span></span></span></span> ——具体来说就是第二列收入数据，需要一个新的字符串转化子程序。
<ul>
<li>上述子程序，需要调用实验10.2中的<strong>没有溢出的除法</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p>每一个操作(没有显性)修改的寄存器，需注意寄存器之间的数据依赖关系</p>
<ul>
<li>16位乘除法中，对 <code>dx</code> 的修改(将写覆盖dx中原先保存的值)</li>
<li><code>loop</code> 循环中，对寄存器 <code>cx</code> 中数据的使用</li>
</ul>
</li>
<li>
<p>操作的基本单位</p>
<ul>
<li>例如入栈、出栈操作的基本单位是<strong>字</strong>。
<ul>
<li>注意是否会引起不必要的数据入栈或者出栈。（通过初始化寄存器解决入栈的数据问题，通过正常使用栈解决出栈问题。）</li>
<li><strong>不要</strong>试图通过每次入栈后调整栈顶指针实现按字节入栈（出栈同理）。这可能因操作不当引发写覆盖。也可能导致在最后一次出栈的时候出栈了其它无关的数据等，总之，会引起不必要的麻烦。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>寄存器</p>
<ul>
<li>有些 <code>reg</code>有默认的<code>sreg</code>，所以最好都显示写出来
<ul>
<li><code>bx、si、di</code> 的默认段寄存器是 <code>ds</code></li>
<li><code>bp</code> 的默认段寄存器是 <code>ss</code></li>
</ul>
</li>
<li><strong>选择恰当的寄存器</strong>
<ul>
<li>16位加减法或 <code>mov</code> 操作中，对可能并不需要的高8位会产生影响</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>初始化和保存现场</strong>都是好习惯</p>
<ul>
<li>使用寄存器前应当先初始化
<ul>
<li>初始化前利用栈备份寄存器的值</li>
</ul>
</li>
<li><strong>内存初始化</strong>，即 <code>data segment, stack segment等</code> 的初始化
<ul>
<li>注意 <code>dup</code> 的语法格式</li>
</ul>
</li>
<li><strong>显存也要初始化</strong>，不然会打印很多乌七八糟的奇怪的东西出来。或者可能打印不出来，或者可能死机。</li>
<li>所有子程序中用到的寄存器都应该在子程序开头顺序入栈，子程序结尾逆序出栈。<strong>在子程序执行过程中不应该修改调用者赋予寄存器的值</strong>，除非该子程序对指定寄存器有返回值
<ul>
<li>事实上在一段代码中间，因为寄存器有限，所以将寄存器作为临时寄存器使用时也应注意利用栈保存现场。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>选择合适的寻址方式</p>
<ul>
<li>合适的寻址方式可以让程序更清晰，代码更简洁</li>
<li>如果代码写的太长，<code>loop</code> 的时候会报错说跳转超过范围(-128~127)</li>
</ul>
</li>
<li>
<p>相关语法细节</p>
<ul>
<li>注意<code>dup</code> 的语法格式。实际上<code>dup(0,0,0,0)</code>这样的写法和c语言初始化数组的写法是类似的</li>
<li><code>loop s</code> 指令等价于 <code>cx-=1, if ((cx)!=0) jmp s</code> ；而 <code>jcxz s</code> 指令等价于<code>if ((cx)==0) jmp s</code> 。这两条指令不可混淆。</li>
</ul>
</li>
<li>
<p>显存</p>
<ul>
<li><strong>显存也要初始化</strong>，不然会打印很多乌七八糟的奇怪的东西出来。或者可能打印不出来，或者可能死机。</li>
<li>涉及显存的debug需将行号设置的大一些，不然头几行屏幕上显示不出来，这是因为dos中debug每执行一次t操作所附带的几行寄存器相关信息的输出将覆盖掉我们自己写的输出。同理，也可能导致输出一闪而过等。可以先将 (搬运内容至显存的整个循环) 执行，看一下情况，再具体单步调试。</li>
<li>往显存写入的时候，应该先写入属性，再写入字符，先变个色比较便于确认位置。</li>
</ul>
</li>
<li>
<p>数学问题</p>
<ul>
<li>行号和列号的计算见课本实验7，以及文首参考资料中实验7中关于第0行的说明</li>
<li>进制转换</li>
<li>divdw的设计中用到的思路及公式见课本实验10-2</li>
</ul>
</li>
<li>
<p>反思(吐槽)</p>
<ul>
<li>程序设计
<ul>
<li>一个操作到底应该放在哪里执行——由调用者执行，还是某个子程序执行，还是单独再写一个子程序执行，这是一个哲学问题，主要应当从<strong>函数的可复用性</strong>来考虑设计，也即模块化设计。模块化设计就要求通用性，应当便于别人使用，不能在计数上偷懒瞎搞(瞎搞并不是奇技淫巧！不能玷污奇技淫巧！)。
<ul>
<li>以<code>show_str</code>函数为例。<br>
对于每一年数据中间的空白处由0置成空格应由调用者保证，即每一年的所有数据构成一个字符串。因为要打印的数据应该由调用者遵照子程序接口提供，而这里的接口是只有字符串结尾处才应该有结束符，字符串中间的子串之间不应当出现结尾符0。<br>
对于每一年数据开始之前和结尾之后的空白处置0应在<code>show_str</code>中实现，因为屏幕上默认只应有需要的字符串，其它位置的显存初始化应当由打印函数进行封装。</li>
</ul>
</li>
<li>写一个函数的具体实现前，养成习惯先写<strong>名字、功能、参数、返回值</strong>。</li>
</ul>
</li>
<li>从利用栈保存现场和恢复现场的角度来看，难怪c语言有形参和实参的问题(即修改复制的那一份值而不是调用者的变量所在地址存储的值)；c++有浅拷贝和深拷贝的问题；听说python也有...</li>
</ul>
</li>
</ul>
<h4 id="完整代码如下"><a class="markdownIt-Anchor" href="#完整代码如下"></a> 完整代码如下</h4>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</span><br><span class="line"></span><br><span class="line">data <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;1975&#x27;</span>,<span class="string">&#x27;1976&#x27;</span>,<span class="string">&#x27;1977&#x27;</span>,<span class="string">&#x27;1978&#x27;</span>,<span class="string">&#x27;1979&#x27;</span>,<span class="string">&#x27;1980&#x27;</span>,<span class="string">&#x27;1981&#x27;</span>,<span class="string">&#x27;1982&#x27;</span>,<span class="string">&#x27;1983&#x27;</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;1984&#x27;</span>,<span class="string">&#x27;1985&#x27;</span>,<span class="string">&#x27;1986&#x27;</span>,<span class="string">&#x27;1987&#x27;</span>,<span class="string">&#x27;1988&#x27;</span>,<span class="string">&#x27;1989&#x27;</span>,<span class="string">&#x27;1990&#x27;</span>,<span class="string">&#x27;1991&#x27;</span>,<span class="string">&#x27;1992&#x27;</span></span><br><span class="line"> <span class="built_in">db</span> <span class="string">&#x27;1993&#x27;</span>,<span class="string">&#x27;1994&#x27;</span>,<span class="string">&#x27;1995&#x27;</span></span><br><span class="line">  <span class="comment">;以上是表示21年的21个字符串</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">16</span>,<span class="number">22</span>,<span class="number">382</span>,<span class="number">1356</span>,<span class="number">2390</span>,<span class="number">8000</span>,<span class="number">16000</span>,<span class="number">24486</span>,<span class="number">50065</span>,<span class="number">97479</span>,<span class="number">140417</span>,<span class="number">197514</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">345980</span>,<span class="number">590827</span>,<span class="number">803530</span>,<span class="number">1183000</span>,<span class="number">1843000</span>,<span class="number">2759000</span>,<span class="number">3753000</span>,<span class="number">4649000</span>,<span class="number">5937000</span></span><br><span class="line">  <span class="comment">;以上是表示21年公司总收入的21个dword型数据, base=data+84</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">3</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">13</span>,<span class="number">28</span>,<span class="number">38</span>,<span class="number">130</span>,<span class="number">220</span>,<span class="number">476</span>,<span class="number">778</span>,<span class="number">1001</span>,<span class="number">1442</span>,<span class="number">2258</span>,<span class="number">2793</span>,<span class="number">4037</span>,<span class="number">5635</span>,<span class="number">8226</span></span><br><span class="line"> <span class="built_in">dw</span> <span class="number">11542</span>,<span class="number">14430</span>,<span class="number">15257</span>,<span class="number">17800</span></span><br><span class="line">  <span class="comment">;以上是表示21年公司雇员人数的21个word型数据,base=data+168</span></span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">dec_table <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">21</span> dup (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,) <span class="comment">;每年数据占32位，一共21年</span></span><br><span class="line">dec_table ends</span><br><span class="line"></span><br><span class="line">stack <span class="meta">segment</span></span><br><span class="line"> <span class="built_in">dd</span> <span class="number">8</span> dup (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"><span class="symbol">start:</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,data</span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">es</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,dec_table </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,stack </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ss</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">0</span>  <span class="comment">;某类数据的某一项作为源数据，其地址相对基址的偏移</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">di</span>,<span class="number">0</span>  <span class="comment">;目的地址的偏移</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">21</span>  <span class="comment">;循环计数器</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol"> s:</span> </span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">cx</span>  <span class="comment">;计数器值入栈</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">;年份</span></span><br><span class="line">  <span class="comment">;计算偏移</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="built_in">bx</span> </span><br><span class="line">  <span class="comment">;搬运年份</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">es</span>:[<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">mov</span> [<span class="built_in">di</span>],<span class="built_in">ax</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">es</span>:[<span class="built_in">bx</span>+<span class="number">2</span>]</span><br><span class="line">  <span class="keyword">mov</span> [<span class="built_in">di</span>+<span class="number">2</span>],<span class="built_in">ax</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="comment">;收入</span></span><br><span class="line">  <span class="comment">;计算偏移</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="built_in">bx</span> </span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">di</span>,<span class="number">8</span></span><br><span class="line">  <span class="comment">;传参,搬运收入</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">es</span>:<span class="number">84</span>[<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="built_in">es</span>:<span class="number">84</span>[<span class="built_in">bx</span>+<span class="number">2</span>]</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">si</span>,<span class="built_in">di</span></span><br><span class="line">  <span class="keyword">call</span> dtoc_dw</span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="comment">;雇员数</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">ax</span></span><br><span class="line">  <span class="comment">;传参，搬运雇员数  </span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">di</span>,<span class="number">11</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">es</span>:<span class="number">168</span>[<span class="built_in">bx</span>]</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">si</span>,<span class="built_in">di</span></span><br><span class="line">  <span class="keyword">call</span> dtoc_w</span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="built_in">ax</span> <span class="comment">;cx中存储计算人均收入用到的除数</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">ax</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="comment">;人均收入</span></span><br><span class="line">  <span class="comment">;传参，计算，存储</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">di</span>,<span class="number">9</span></span><br><span class="line">  <span class="keyword">div</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">si</span>,<span class="built_in">di</span></span><br><span class="line">  <span class="keyword">call</span> dtoc_w</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="comment">;步长</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">di</span>,<span class="number">4</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">2</span> <span class="comment">;取最小的数据项的大小作为步长</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">;打印预处理</span></span><br><span class="line">  <span class="comment">;将每一行数据中间的0都换成空格，保留最后一个0作为结束符</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">28</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">di</span></span><br><span class="line">  <span class="keyword">sub</span> <span class="built_in">di</span>,<span class="number">20h</span></span><br><span class="line"><span class="symbol">  adjust:</span></span><br><span class="line">   <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">0</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="built_in">ds</span>:[<span class="built_in">di</span>]</span><br><span class="line">   <span class="keyword">jcxz</span> set_zero</span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">di</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">loop</span> adjust</span><br><span class="line"><span class="symbol">   set_zero:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="string">&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">ds</span>:[<span class="built_in">di</span>],<span class="built_in">cl</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">di</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line">  <span class="keyword">loop</span> adjust</span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">di</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">bp</span>,<span class="built_in">sp</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">ss</span>:[<span class="built_in">bp</span>] <span class="comment">;取循环计数器cx的值</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">dx</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="number">dh</span>,<span class="number">21</span>+<span class="number">3</span> <span class="comment">;行号为3;</span></span><br><span class="line">   <span class="keyword">sub</span> <span class="number">dh</span>,<span class="built_in">al</span> <span class="comment">;行号每次循环应当改变</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">dl</span>,<span class="number">5</span> <span class="comment">;列号为5;</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="number">2</span> <span class="comment">;颜色</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">si</span>,<span class="built_in">di</span></span><br><span class="line">   <span class="keyword">sub</span> <span class="built_in">si</span>,<span class="number">20h</span> <span class="comment">;字符串首地址</span></span><br><span class="line">   <span class="comment">;prt</span></span><br><span class="line">   <span class="keyword">call</span> show_str</span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">dx</span></span><br><span class="line">  </span><br><span class="line"> <span class="keyword">pop</span> <span class="built_in">cx</span>    <span class="comment">;计数器值出栈</span></span><br><span class="line"> <span class="keyword">loop</span> s</span><br><span class="line"> </span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"><span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">;name:  dtoc_dw</span></span><br><span class="line"><span class="comment">;function: 将dword型数转变为十进制数的字符串，字符串以0为结尾符</span></span><br><span class="line"><span class="comment">;parameter: (ax)=dword型数据的低16位</span></span><br><span class="line"><span class="comment">;   (dx)=dword型数据的高16位</span></span><br><span class="line"><span class="comment">;   ds:si 指向字符串的首地址</span></span><br><span class="line"><span class="comment">;return:null</span></span><br><span class="line"><span class="symbol">dtoc_dw:</span></span><br><span class="line"><span class="comment">;保存现场</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">si</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">ax</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">dx</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;initialize cx</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">0</span> <span class="comment">;初始化cx</span></span><br><span class="line"> <span class="comment">;字符串以0为结尾符,应该放在栈底</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="symbol"> compute_dw:</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">10</span><span class="comment">;divdw中用cx存放除数</span></span><br><span class="line">  <span class="keyword">call</span> divdw</span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">cx</span>,<span class="number">30h</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">;判断是否商为0</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">0</span></span><br><span class="line">  <span class="keyword">or</span> <span class="built_in">cx</span>,<span class="built_in">ax</span></span><br><span class="line">  <span class="keyword">or</span> <span class="built_in">cx</span>,<span class="built_in">dx</span>  </span><br><span class="line">  <span class="keyword">jcxz</span> save2data_dw <span class="comment">;quotient==0, conversion ends</span></span><br><span class="line">  <span class="keyword">jmp</span> compute_dw</span><br><span class="line"> </span><br><span class="line"><span class="symbol"> save2data_dw:</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="built_in">bl</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ds</span>:[<span class="built_in">si</span>],<span class="built_in">cl</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">si</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">jcxz</span> ok_dtoc_dw</span><br><span class="line">  <span class="keyword">jmp</span> save2data_dw</span><br><span class="line"> </span><br><span class="line"><span class="comment">;恢复现场</span></span><br><span class="line"><span class="symbol">ok_dtoc_dw:</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">dx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">si</span></span><br><span class="line"><span class="keyword">ret</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;name:divdw</span></span><br><span class="line"><span class="comment">;function: 进行不会产生溢出的除法运算，被除数为dword型，除数为word型，结果为dword型</span></span><br><span class="line"><span class="comment">;parameter: (ax)=dword型数据的低16位</span></span><br><span class="line"><span class="comment">;   (dx)=dword型数据的高16位</span></span><br><span class="line"><span class="comment">;   (cx)=除数</span></span><br><span class="line"><span class="comment">;return: (ax)=结果的低16位</span></span><br><span class="line"><span class="comment">;   (dx)=结果的高16位</span></span><br><span class="line"><span class="comment">;   (cx)=余数</span></span><br><span class="line"><span class="comment">;test_data F4240H/0AH=0001H 86A0H ... 0</span></span><br><span class="line"><span class="comment">;notation: X: 被除数</span></span><br><span class="line"><span class="comment">;  N: 除数</span></span><br><span class="line"><span class="comment">;  H: X高16位</span></span><br><span class="line"><span class="comment">;  L: X低16位</span></span><br><span class="line"><span class="comment">;  int: 去尾取整</span></span><br><span class="line"><span class="comment">;  rem: 取余数</span></span><br><span class="line"><span class="comment">;equation: X/N=int(H/N)*65536+(rem(H/N)*65536+L)/N</span></span><br><span class="line"><span class="symbol">divdw:</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="built_in">ax</span> <span class="comment">; save L</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">;compute int(H/N) </span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">dx</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">div</span> <span class="built_in">cx</span> <span class="comment">; quotient in ax, remainder in dx</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">ax</span> <span class="comment">;计算结果的高16位入栈保存</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;compute (rem(H/N)*65536+L)/N</span></span><br><span class="line"> <span class="comment">;从bx中取回X低16位(L)</span></span><br><span class="line"> <span class="comment">;rem(H/N)已经在dx中，因为dx是被除数的高16位，所以相当于乘了65536</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">bx</span></span><br><span class="line"> <span class="keyword">div</span> <span class="built_in">cx</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;在指定寄存器中存储结果</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="built_in">dx</span></span><br><span class="line"> <span class="keyword">pop</span> <span class="built_in">dx</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">ret</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;name: dtoc_w</span></span><br><span class="line"><span class="comment">;function: 将word型数据转变为表示十进制数的字符串，字符串以0为结尾符</span></span><br><span class="line"><span class="comment">;parameter: (ax)=word型数据</span></span><br><span class="line"><span class="comment">;   ds:si指向字符串的首地址</span></span><br><span class="line"><span class="comment">;return: null</span></span><br><span class="line"><span class="comment">;application: 将数据12666以十进制的形式在屏幕的8行3列，用黑底绿字显示出来。</span></span><br><span class="line"><span class="symbol">dtoc_w:</span></span><br><span class="line"><span class="comment">;保存现场</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">si</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">ax</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">dx</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;initialize cx,bx</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">10</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;字符串以0为结尾符,应该放在栈底</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"> </span><br><span class="line"><span class="symbol"> compute:</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0</span></span><br><span class="line">  <span class="keyword">div</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">dx</span>,<span class="number">30h</span></span><br><span class="line">  <span class="keyword">push</span> <span class="built_in">dx</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="built_in">ax</span>  <span class="comment">;ax中存的商赋值给cx</span></span><br><span class="line">  <span class="keyword">jcxz</span> save2data <span class="comment">;quotient==0, conversion ends</span></span><br><span class="line">  <span class="keyword">jmp</span> compute</span><br><span class="line"> </span><br><span class="line"><span class="symbol"> save2data:</span></span><br><span class="line">  <span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="built_in">bl</span> <span class="comment">;只有低8位存放着需要的数据</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ds</span>:[<span class="built_in">si</span>],<span class="built_in">cl</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">si</span></span><br><span class="line">  <span class="keyword">jcxz</span> ok_dtoc_w</span><br><span class="line">  <span class="keyword">jmp</span> save2data</span><br><span class="line"> </span><br><span class="line"><span class="comment">;恢复现场</span></span><br><span class="line"><span class="symbol">ok_dtoc_w:</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">dx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">si</span></span><br><span class="line"><span class="keyword">ret</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;名称: show_str</span></span><br><span class="line"><span class="comment">;功能：在指定的位置，用指定的颜色，显示一个用0结束的字符串</span></span><br><span class="line"><span class="comment">;参数： (dh)=行号(取值范围0~24), </span></span><br><span class="line"><span class="comment">;  (dl)=列号(取值范围0~79)</span></span><br><span class="line"><span class="comment">;  (cl)=颜色, </span></span><br><span class="line"><span class="comment">;  ds:si 指向字符串的首地址</span></span><br><span class="line"><span class="comment">;返回：无</span></span><br><span class="line"><span class="comment">;test_data: 在屏幕8行3列处，用绿色显示data段中的字符串</span></span><br><span class="line"><span class="symbol">show_str:</span></span><br><span class="line"><span class="comment">;保存现场</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">ax</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">dx</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">si</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">di</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">es</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;先计算行偏移地址，再加到页首起始地址上，存放在es段寄存器中</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">0ah</span></span><br><span class="line"> <span class="keyword">mul</span> <span class="number">dh</span></span><br><span class="line"> <span class="keyword">add</span> <span class="built_in">ax</span>,<span class="number">0b800h</span> <span class="comment">;0b800h是显存的起始地址</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">es</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;计算列偏移地址。列偏移起始地址=列号*2-2</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">0</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">dl</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">bl</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">mul</span> <span class="built_in">bl</span> </span><br><span class="line"> <span class="keyword">sub</span> <span class="built_in">ax</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">di</span>,<span class="built_in">ax</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;暂存颜色属性</span></span><br><span class="line"> <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">cl</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;开始打印数据前的部分置为空</span></span><br><span class="line"> <span class="keyword">push</span> <span class="built_in">dx</span></span><br><span class="line">  <span class="comment">;计算需置空的字符个数</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="built_in">dl</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">ch</span>,<span class="number">0</span></span><br><span class="line">  <span class="comment">;计算起始列起始地址</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0</span></span><br><span class="line">   <span class="keyword">call</span> set_space</span><br><span class="line"> <span class="keyword">pop</span> <span class="built_in">dx</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">;按要求搬运内容至显存指定位置，以指定格式输出</span></span><br><span class="line"><span class="symbol"> prt:</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">ch</span>,<span class="number">0</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="built_in">ds</span>:[<span class="built_in">si</span>]</span><br><span class="line">  <span class="keyword">jcxz</span> after  <span class="comment">;若cx==0，子程序运行结束</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>+<span class="number">1</span>],<span class="built_in">al</span> <span class="comment">;搬运属性</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>],<span class="built_in">cl</span>  <span class="comment">;搬运字符</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">di</span>,<span class="number">2</span></span><br><span class="line">  <span class="comment">;搬运下一个字符</span></span><br><span class="line">  <span class="keyword">inc</span> <span class="built_in">si</span></span><br><span class="line">  </span><br><span class="line"> <span class="keyword">jmp</span> short prt</span><br><span class="line"> </span><br><span class="line"> <span class="comment">;结束打印数据后的部分置为空</span></span><br><span class="line"><span class="symbol"> after:</span></span><br><span class="line">  <span class="comment">;计算需置空的字符个数</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">0</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">di</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="number">2</span></span><br><span class="line">  <span class="keyword">div</span> <span class="built_in">cl</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="number">80</span></span><br><span class="line">  <span class="keyword">sub</span> <span class="built_in">cl</span>,<span class="built_in">al</span></span><br><span class="line">  <span class="comment">;计算起始列起始地址</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="built_in">di</span></span><br><span class="line">  <span class="keyword">call</span> set_space</span><br><span class="line">  </span><br><span class="line"><span class="comment">;恢复现场</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">es</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">di</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">si</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">dx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></span><br><span class="line"><span class="keyword">ret</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">;name:set_space</span></span><br><span class="line"><span class="comment">;function: 使得指定区间的所有列显示为空</span></span><br><span class="line"><span class="comment">;parameter: (dl)=起始列起始地址(取值范围1~80)</span></span><br><span class="line"><span class="comment">;   (cx)=区间中字符个数(取值范围0~80)</span></span><br><span class="line"><span class="comment">;return: null</span></span><br><span class="line"><span class="symbol">set_space:</span></span><br><span class="line"><span class="keyword">jcxz</span> end_set_space</span><br><span class="line"><span class="keyword">push</span> <span class="built_in">ax</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">;低8位存字符ascii码置零，高8位存属性置零</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">0</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">bh</span>,<span class="number">0</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">bl</span>,<span class="built_in">dl</span></span><br><span class="line"><span class="symbol"> set_:</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>],<span class="built_in">ax</span></span><br><span class="line">  <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">2</span></span><br><span class="line"> <span class="keyword">loop</span> set_</span><br><span class="line"> </span><br><span class="line"><span class="symbol">end_set_space:</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></span><br><span class="line"><span class="keyword">ret</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<h4 id="运行结果如下"><a class="markdownIt-Anchor" href="#运行结果如下"></a> 运行结果如下</h4>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/posts/masm-wangshuang-exercise-1/课设1-终稿.png">
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">课设1</div>
</center>

    </div>

    
    
    
        <div class="reward-container">
  <div>Thanks for your reading!</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/alipay.jpg" alt="yx 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>yx
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/" title="汇编语言（第四版）-王爽 (题解)-1">https://eyxxxxx.github.io/posts/masm-wangshuang-exercise-1/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/assembly/" rel="tag"># assembly</a>
              <a href="/tags/DOS/" rel="tag"># DOS</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item"></div>
      <div class="post-nav-item">
    <a href="/posts/about%20two's%20complement/" rel="next" title="笔记-补码的来龙去脉">
      笔记-补码的来龙去脉 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">1.</span> <span class="nav-text"> 参考资料</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8"><span class="nav-number">2.</span> <span class="nav-text"> 注</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ch6"><span class="nav-number">3.</span> <span class="nav-text"> CH6</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C5"><span class="nav-number">3.1.</span> <span class="nav-text"> 实验5</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ch7"><span class="nav-number">4.</span> <span class="nav-text"> CH7</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C6"><span class="nav-number">4.1.</span> <span class="nav-text"> 实验6</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ch8"><span class="nav-number">5.</span> <span class="nav-text"> CH8</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C7"><span class="nav-number">5.1.</span> <span class="nav-text"> 实验7</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ch9"><span class="nav-number">6.</span> <span class="nav-text"> CH9</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%B5%8B%E7%82%B991"><span class="nav-number">6.1.</span> <span class="nav-text"> 检测点9.1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C8"><span class="nav-number">6.2.</span> <span class="nav-text"> 实验8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C9"><span class="nav-number">6.3.</span> <span class="nav-text"> 实验9</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ch10"><span class="nav-number">7.</span> <span class="nav-text"> CH10</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C10"><span class="nav-number">7.1.</span> <span class="nav-text"> 实验10</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%98%BE%E7%A4%BA%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">7.1.1.</span> <span class="nav-text"> 1. 显示字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%A7%A3%E5%86%B3%E9%99%A4%E6%B3%95%E6%BA%A2%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">7.1.2.</span> <span class="nav-text"> 2. 解决除法溢出的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E6%95%B0%E5%80%BC%E6%98%BE%E7%A4%BA"><span class="nav-number">7.1.3.</span> <span class="nav-text"> 3.数值显示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A11"><span class="nav-number">7.2.</span> <span class="nav-text"> 课程设计1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90"><span class="nav-number">7.2.1.</span> <span class="nav-text"> 题目分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">7.2.2.</span> <span class="nav-text"> 总结(注意事项)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E5%A6%82%E4%B8%8B"><span class="nav-number">7.2.3.</span> <span class="nav-text"> 完整代码如下</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B"><span class="nav-number">7.2.4.</span> <span class="nav-text"> 运行结果如下</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <a href="/about/">
		<img class="site-author-image" itemprop="image" alt="yx"
		  src="/images/avatar.jpg">
	  <p class="site-author-name" itemprop="name">yx</p>
    </a>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://liam.page/" title="https:&#x2F;&#x2F;liam.page&#x2F;" rel="noopener" target="_blank">Liam Huang</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yx</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

<!--修改的强力驱动部分代码-->
  <div class="powered-by"><a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v5.3.0  | <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.8.0 
  </div>

<div id="days"></div>
<script>
function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
    BirthDay=new Date("01/17/2021 16:28:21");
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
    secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
    e_daysold=timeold/msPerDay
    daysold=Math.floor(e_daysold);
    e_hrsold=(e_daysold-daysold)*24;
    hrsold=setzero(Math.floor(e_hrsold));
    e_minsold=(e_hrsold-hrsold)*60;
    minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
    seconds=setzero(Math.floor((e_minsold-minsold)*60));
    document.getElementById('days').innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒";
}
function setzero(i) {
    if (i<10) {
        i="0" + i
    };
    return i;
}
show_date_time();
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <span><br></span> -->	
<span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
</span>
<span><!-- 关键词: 访问人数 -->&nbsp<span id="busuanzi_value_site_uv"></span>&nbsp<!-- 关键词: 人 --></span>
    <span class="post-meta-divider">|</span>
<span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
</span>
    <span><!-- 关键词: 访问总量 -->&nbsp<span id="busuanzi_value_site_pv"></span>&nbsp<!-- 关键词: 次 --></span>


        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"RQeK67Eplz04aMuO2n8QVJpY-gzGzoHsz","app_key":"i2q15jC56GgjnHMqCN8kKjhL","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":230,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}i(),n.addEventListener("scroll",function(){var t,e;t=i,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>
